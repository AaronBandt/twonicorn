<div metal:use-macro="layout">
    <div metal:fill-slot="content">

    <div id="promote_main">

      <p tal:condition="not denied and not artifact_id">
        This page should display paginated list of promotions. For now you must select a deploy to promote from the deploys page.
      </p>
  
      <div id="error" tal:condition="denied">
          <p class="error">
          <img src="static/logo_medium.gif">
          </p>
  
          <h2 class="error" tal:condition="message" tal:content="message"/>
  
      </div>

      <div id="promote_results" tal:condition="not denied and artifact_id">
 
        <h1 tal:condition="to_state == '3'">
        Stage artifact ID for ${to_env}? ${artifact_id}
        </h1>

        <h1 tal:condition="to_state != '3'">
        Promote artifact ID to ${to_env}? ${artifact_id}
        </h1>

        <p>
        <table width="100%"> 
          <tr>
            <th>Application Name</th>
            <th>Deploy Path</th>
            <th>Revision</th>
            <th>Branch/Tag</th>
            <th>Repo</th>
            <th>Artifact Type</th>
            <th>URL Location</th>
            <th>Created Date</th>
          </tr>

          <tr tal:attributes="class '%s' % to_env">
            <td tal:content="promote.artifact_assignments[0].deploy.application.application_name">myapp</td>
            <td tal:content="promote.artifact_assignments[0].deploy.deploy_path" tal:attributes="title 'Deploy ID: ' + str(deploy_id)">/app/something</td>
            <td tal:content="promote.revision [:8]">12345</td>
            <td tal:content="promote.branch">trunk</td>
            <td tal:content="promote.repo.name">12345</td>
            <td tal:content="promote.artifact_assignments[0].deploy.type.name">12345</td>
            <td><a href="http://code.ctgrd.com/my/awesome/artifact.war"
                   title="some description"
                   tal:attributes="href promote.artifact_assignments[0].pretty_url; title promote.artifact_assignments[0].pretty_url"
                   tal:content="promote.location">Artifact</a></td>
            <td tal:content="promote.created">12345</td>
          </tr>
        </table>
        </p>

        <p>
          <form method="POST" tal:attributes="action '/promote?deploy_id=%s&artifact_id=%s&to_env=%s&&commit=true' %
                                             (deploy_id,
                                              artifact_id,
                                              to_env,
                                             );">
           <input type="hidden" name="form.submitted"/>
           <p>
           <table>
             <tr>
               <td>
                 <input tal:condition="to_state == '3'" class="button_submit" type="submit" name="submit" value="Stage"/>
                 <input tal:condition="to_state != '3'" class="button_submit" type="submit" name="submit" value="Promote"/>
               </td>
               <td>
                 <a href="/"><input class="button_submit" type="button" value="Cancel" /></a>
               </td>
             </tr>
           </table>
           </p>
        </p>

      </div>
    </div>

  </div>
</div>

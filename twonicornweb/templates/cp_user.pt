<div metal:use-macro="layout">
    <div metal:fill-slot="content">

      <script src="/static/jquery-2.1.3.min.js"></script>
      <script src="/static/row_expansion_user.js"></script>

      <div tal:condition="not commit and mode == 'add'">
        <p>

          <form class="cp_form_user" action="/cp/user?mode=add&commit=true" method="POST">
            <input type="hidden" name="form.submitted"/>
            <ul>
              <li>
                <h2>${subtitle}</h2>
                <span class="required_notification">* Denotes Required Field</span>
              </li>
            <ul>
              <li>
                <h3>Group List</h3>
              </li>
              <li>

                <table id="tab_user">
                  <tbody>
                    <tr id='addr0'>
                      <td>
                        <span for="user_name">User Name:</span><br>
                        <input type="text" id="user_name" name="user_name" required/>
                        <span class="form_hint">The user name you wish to add</span>
                      </td>
                    </tr>
                    <tr id='addr1'></tr>
                  </tbody>
                </table>

              </li>
            </ul>
            <ul>
              <li class="exp">
                <input id="add_row" class="button exp" type="button" value="Add Another User"/>
                <input id="delete_row" class="button exp disable" type="button" value="Remove Last Row"/>
              </li>
              <li>
                <input class="button" type="submit" name="submit" value="submit"/>
              </li>
            </ul>
          </form>

        </p>
      </div>


      <div tal:condition="not commit and mode == 'edit'">
        <p>

          <form class="cp_form_user" action="/cp/user?mode=edit&commit=true" method="POST">
            <input type="hidden" name="form.submitted"/>
            <input tal:attributes="value user.user_id" type="hidden" name="user_id"/>
            <ul>
              <li>
                <h2>${subtitle}</h2>
                <span class="required_notification">* Denotes Required Field</span>
              </li>
            <ul>
              <li>
                <h3>Group</h3>
              </li>
              <li>

                <table>
                  <tbody>
                    <tr>
                      <td>
                        <span for="group_name">Group Name:</span><br>
                        <input tal:attributes="value group.group_name" type="text" id="group_name" name="group_name" required/>
                        <span class="form_hint">The full AD name of the group</span>
                      </td>
                      <td>
                        <span for="group_perms">Promote:</span><br>
                        <input tal:attributes="checked True if ('promote_prd' in group.get_all_assignments()) else False" type="checkbox" name="perms" value="promote_prd">
                      </td>
                      <td>
                        <span for="group_perms">Control Panel:</span><br>
                        <input tal:attributes="checked True if ('cp' in group.get_all_assignments()) else False" type="checkbox" name="perms" value="cp">
                      </td>
                    </tr>
                  </tbody>
                </table>

              </li>
            </ul>
            <ul>
              <li>
                <input class="button" type="submit" name="submit" value="submit"/>
              </li>
            </ul>
          </form>

        </p>
      </div>

      <div tal:condition="not commit and not mode">

        <p>All configured users and their permissions</p>
    
        <p>
        <table>
          <tr>
            <th>Group ID</th>
            <th>Group Name</th>
            <th tal:repeat="perm all_perms" tal:content="perm.perm_name">Promote</th>
            <th>Created</th>
            <th>Updated</th>
            <th>User</th>
            <th tal:condition="user.cp_auth"></th>
          </tr>
          <tbody tal:repeat="item users">
          <tr class="user">
            <td tal:content="item.user_id">
            <td tal:content="item.user_name">
            <td tal:content="item.first">
            <td tal:content="item.last">
            <td tal:content="item.email_address">
            <td tal:condition="user.cp_auth"><a href="/cp/user?mode=edit&group_id=0"
                   tal:attributes="href '/cp/user?mode=edit&user_id=%s' % item.user_id">Edit</a></td>
          </tr>
          </tbody>
        </table>

      </div>

  </div>
</div>
